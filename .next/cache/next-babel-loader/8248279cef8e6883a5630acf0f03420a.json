{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport baseUrl from '../helpers/baseUrl';\nimport { parseCookies } from 'nookies';\nimport cookie from 'js-cookie';\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { useState } from 'react';\nimport StripeCheckout from 'react-stripe-checkout';\n\nconst Cart = ({\n  error,\n  products\n}) => {\n  const {\n    token\n  } = parseCookies();\n  const router = useRouter();\n  const {\n    0: cProducts,\n    1: setCartProduct\n  } = useState(products);\n  let price = 0;\n\n  if (!token) {\n    return __jsx(\"div\", {\n      className: \"center-align\"\n    }, __jsx(\"h3\", null, \"please login to view your cart\"), __jsx(Link, {\n      href: \"/login\"\n    }, __jsx(\"a\", null, __jsx(\"button\", {\n      className: \"btn #1565c0 blue darken-3\"\n    }, \"Login\"))));\n  }\n\n  if (error) {\n    M.toast({\n      html: error,\n      classes: \"red\"\n    });\n    cookie.remove(\"user\");\n    cookie.remove(\"token\");\n    router.push('/login');\n  }\n\n  const handleRemove = async pid => {\n    const res = await fetch(`${baseUrl}/api/cart`, {\n      method: \"DELETE\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": token\n      },\n      body: JSON.stringify({\n        productId: pid\n      })\n    });\n    const res2 = await res.json();\n    setCartProduct(res2);\n  };\n\n  const CartItems = () => {\n    return __jsx(React.Fragment, null, cProducts.map(item => {\n      price = price + item.quantity * item.product.price;\n      return __jsx(\"div\", {\n        style: {\n          display: \"flex\",\n          margin: \"20px\"\n        },\n        key: item._id\n      }, __jsx(\"img\", {\n        src: item.product.mediaUrl,\n        style: {\n          width: \"30%\"\n        }\n      }), __jsx(\"div\", {\n        style: {\n          marginLeft: \"20px\"\n        }\n      }, __jsx(\"h6\", null, item.product.name), __jsx(\"h6\", null, item.quantity, \" x  \\u20B9 \", item.product.price), __jsx(\"button\", {\n        className: \"btn red\",\n        onClick: () => {\n          handleRemove(item.product._id);\n        }\n      }, \"remove\")));\n    }));\n  };\n\n  const handleCheckout = async paymentInfo => {\n    console.log(paymentInfo);\n    const res = await fetch(`${baseUrl}/api/payment`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": token\n      },\n      body: JSON.stringify({\n        paymentInfo\n      })\n    });\n    const res2 = await res.json();\n    M.toast({\n      html: res2.mesage,\n      classes: \"green \"\n    });\n    router.push('/');\n  };\n\n  const TotalPrice = () => {\n    return __jsx(\"div\", {\n      className: \"container\",\n      style: {\n        display: \"flex\",\n        justifyContent: \"space-between\"\n      }\n    }, __jsx(\"h5\", null, \"total \\u20B9 \", price), products.length != 0 && __jsx(StripeCheckout, {\n      name: \"My store\",\n      amount: price * 100,\n      image: products.length > 0 ? products[0].product.mediaUrl : \"\",\n      currency: \"INR\",\n      shippingAddress: true,\n      billingAddress: true,\n      zipCode: true,\n      stripeKey: \"pk_test_51H6fgDEta3rHzkPYGgIOQZSFrukEzAl71AOnyAUjyGR8uJPDaGfALQYWre4F5g0Quyh9d7PTphh56SmUlhtsQYmd00DZwB9gMj\",\n      token: paymentInfo => handleCheckout(paymentInfo)\n    }, __jsx(\"button\", {\n      className: \"btn\"\n    }, \"Checkout\")));\n  };\n\n  return __jsx(\"div\", {\n    className: \"container\"\n  }, __jsx(CartItems, null), __jsx(TotalPrice, null));\n};\n\nexport async function getServerSideProps(ctx) {\n  const {\n    token\n  } = parseCookies(ctx);\n\n  if (!token) {\n    return {\n      props: {\n        products: []\n      }\n    };\n  }\n\n  const res = await fetch(`${baseUrl}/api/cart`, {\n    headers: {\n      \"Authorization\": token\n    }\n  });\n  const products = await res.json();\n\n  if (products.error) {\n    return {\n      props: {\n        error: products.error\n      }\n    };\n  }\n\n  console.log(\"products\", products);\n  return {\n    props: {\n      products\n    }\n  };\n}\nexport default Cart;","map":null,"metadata":{},"sourceType":"module"}