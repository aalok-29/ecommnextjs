{"ast":null,"code":"import initDB from '../../helpers/initDB';\nimport User from '../../models/User';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\ninitDB();\nexport default (async (req, res) => {\n  const {\n    email,\n    password\n  } = req.body;\n\n  try {\n    if (!email || !password) {\n      return res.status(422).json({\n        error: \"please enter all the fields\"\n      });\n    }\n\n    const user = await User.findOne({\n      email\n    });\n\n    if (!user) {\n      return res.status(404).json({\n        error: \"user dont exists with that email\"\n      });\n    }\n\n    const doMatch = await bcrypt.compare(password, user.password);\n\n    if (doMatch) {\n      const token = jwt.sign({\n        userId: user._id\n      }, process.env.JWT_SECRET, {\n        expiresIn: \"7d\"\n      });\n      const {\n        name,\n        role,\n        email\n      } = user;\n      res.status(201).json({\n        token,\n        user: {\n          name,\n          role,\n          email\n        }\n      });\n    } else {\n      return res.status(401).json({\n        error: \"email or password dont match\"\n      });\n    }\n  } catch (err) {\n    console.log(err);\n  }\n});","map":null,"metadata":{},"sourceType":"module"}